{% extends 'base.html.twig' %}

{% block title %} Galerie de {{ user.pseudo }} {% endblock %} 

{% block body %}

    {% for label, messages in app.flashes %}
        <div class="container">
            <div class="alert alert-{{label}}">
                {% for message in messages %}
                    <p>{{ message | raw }}</p>
                {% endfor %}
            </div>
        </div>
    {% endfor %}

    <div class="user-title" style="background-image: url( {{ user.coverImage }} )">

        <div class="container">
            <h1 class="text-center">{{ user.pseudo }}</h1>
            
        </div>

    </div>

    <div class="container">
        <div class="row">
            <div class="col-md-8 mb-3 mt-2">
                {% autoescape %}
                    {{ user.description | raw }}
                    <div class="container mt-5">
                        <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                        <ol class="carousel-indicators">
                            {% for image in user.images %}
                                <li data-target="#carouselExampleIndicators" data-slide-to="{{ loop.index0 }}" {% if loop.first %}class="active" {% endif %}></li>
                            {% endfor %}
                        </ol>
                        <div class="carousel-inner">
                            {% for image in user.images %}
                            {# {{ dump(image.imageFile) }} #}
                                <div class="carousel-item {% if loop.first %}active{% endif %}">
                                    <img src=" {{ asset(vich_uploader_asset(image, 'imageFile')) }} " class="d-block w-100" alt="#">
                                    {# <img src=" {{ image.url }} " class="d-block w-100" alt="#"> #}
                                    <div class="carousel-caption d-none d-md-block">
                                        <h3>{{user.pseudo}}</h3>
                                        <h4>{{ image.caption }}</h4>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                        <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="sr-only">Previous</span>
                        </a>
                        <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="sr-only">Next</span>
                        </a>
                        </div>
                    </div>
                {% endautoescape %}
            </div>
            <div class="col-md-4">
                <p classh="h2"> {{ user.introduction}} </p>

                {% if user is same as(app.user) %}
                    <div class="mt-3">
                        <a href=" {{ path('account_upload') }} " class="btn btn-primary mr-2 mb-2">Ajoutez des photos</a>
                        <a href=" {{ path('account_profile') }} " class="btn btn-primary mr-2 mb-2">Modifier mes informations</a>
                        <a href=" {{ path('account_password') }} " class="btn btn-primary mr-2 mb-2">Modifier mon mot de passe</a> 
                    </div>
                {% endif %}
            </div>
            {# <div class="col">
                {% set a = ad.author %}
                <div class="row">
                    <div class="col-3">
                        <a href="{{ path('user_show', {'slug': a.slug}) }}">
                            <img src=" {{a.picture }} " class="avatar avatar-medium" alt="Avatar de {{ a.fullName }} ">
                        </a>
                    </div>
                    <div class="col">
                        <a href="{{ path('user_show', {'slug': a.slug}) }}">
                            <h3>{{ a.fullName }}</h3>
                        </a>
                        <span class="badge badge-primary my-3"> {{ a.ads | length }} annonces </span>
                    </div>
                </div>
                {{ a.description | raw }}
            </div> #}
        </div>

        <hr>

        {% if app.user %}

            <div class="alert alert-light">
                <h2 class="alert-heading">Votre avis sur la galerie</h2>
                {{ form_start(form) }}
                {{ form_widget(form) }}
                <button type="submit" class="btn btn-success">Confirmer</button>
                {{ form_end(form) }}
            </div>

        {% else %}
            <p>Connectez-vous pour laisser un commentaire !</p>

        {% endif %}
        <hr>

            {% if user.comments | length > 0 %}
                 <h3 clas="mb-3">Commentaires :</h3>
                 
                 <div class="alert alert-dismissible alert-success">
                    <h4 class="alert-heading">
                        <div class="row align-items-center">
                            <div class="col">
                                Note globale donnée par les utilisateurs 
                            </div>
                            <div class="col">
                                {% include 'common/rating.html.twig' with {'rating': user.avgRatings} %}
                                <br>
                                <small>(Calculée sur {{ user.comments | length }} avis)</small>
                            </div>
                        </div>
                    </h4>
                 </div>
                {% for comment in user.comments %}
                    <div class="bg-light rounded mb-3 py-3 px-3">
                        <strong> {{ comment.author.pseudo }} </strong> a dit :
                        <blockquote>
                            {{ comment.content | raw }}
                        </blockquote>
                        <strong>Note donnée par {{ comment.author.pseudo }} : </strong>

                        {% include 'common/rating.html.twig' with {'rating': comment.rating} %}                 
                    </div>            
                {% endfor %}
            {% else %}
                <h3 class="mb-3">Cette galerie n'a pas encore de commentaire ...</h3>
            {% endif %}
    </div>




{# <div class="user-title" style="background-image: url( {{ user.coverImage }} )">

    <div class="container">
        <h1 class="text-center">{{ user.pseudo }}</h1>
        <p class="text-center"> {{ user.introduction}} </p>
    </div>

</div> #}

{# <div class="container mt-5">
    <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
    <ol class="carousel-indicators">
        {% for image in user.images %}
            <li data-target="#carouselExampleIndicators" data-slide-to="{{ loop.index0 }}" {% if loop.first %}class="active" {% endif %}></li>
        {% endfor %}
    </ol>
    <div class="carousel-inner">
        {% for image in user.images %}
            <div class="carousel-item {% if loop.first %}active{% endif %}">
                <img src=" {{ image.url }} " class="d-block w-100" alt="#">
                <div class="carousel-caption d-none d-md-block">
                    <h3>{{user.pseudo}}</h3>
                    <h4>{{ image.caption }}</h4>
                </div>
            </div>
        {% endfor %}
    </div>
    <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
    </a>
    <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
    </a>
    </div>
</div> #}


{% endblock %} 